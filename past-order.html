<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Past Orders</title>

    <!-- mobile responsive meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <!-- ** Plugins Needed for the Project ** -->
    <!-- Bootstrap -->
    <link rel="stylesheet" href="plugins/bootstrap/bootstrap.min.css">
	<link rel="stylesheet" href="plugins/themify/css/themify-icons.css">
	<link rel="stylesheet" href="plugins/icofont/icofont.min.css">
	<link rel="stylesheet" href="plugins/fontawesome/css/all.css">
	<link rel="stylesheet" href="plugins/aos/aos.css">
	<link rel="stylesheet" href="plugins/magnific-popup/magnific-popup.css">
	<link rel="stylesheet" href="plugins/video-popup/modal-video.min.css">
	<link rel="stylesheet" href="plugins/swiper/swiper.min.css">
	<link rel="stylesheet" href="plugins/date-picker/datepicker.min.css">
	<link rel="stylesheet" href="plugins/clock-picker/clockpicker.min.css">
	<link rel="stylesheet" href="plugins/bootstrap-touchpin/jquery.bootstrap-touchspin.min.css">
	<link rel="stylesheet" href="plugins/devices.min.css">

    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css" />

    <!--Favicon-->
    <link rel="shortcut icon" href="images/favicon.png" type="image/x-icon">
    <link rel="icon" href="images/favicon.png" type="image/x-icon">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src='https://platform-api.sharethis.com/js/sharethis.js#property=5f49ccb7f73f72001282f8ed&product=sop' async='async'></script>

    <style>
        #pastBg {
            background: rgb(239, 239, 243);
            background: linear-gradient(90deg, rgba(239, 239, 243, 1) 0%, rgba(214, 214, 220, 1) 30%, rgba(139, 216, 232, 1) 100%);
        }
    </style>
</head>

<body>
    <div class="preloader">
        <img src="images/preloader.gif" alt="preloader" class="img-fluid">
    </div>
    <!-- Header Start -->

    <header class="navigation fixed-top">

		<nav id="navbar" class="navbar navbar-expand-lg main-nav py-lg-3 position-absolute w-100 "
			style="background: url('./images/bg/bg-2.jpg') 10% 10% no-repeat;position: fixed;top: 0;width: 100%;transition: top 0.3s;z-index: -99;">
			<div class="container">
				<a id="logo" class="navbar-brand" style="float:inline-start;z-index: 100;height:auto;"
					href="index.html">
					<img src="images/logo.png" alt="" class="img-fluid">
				</a>

				<button class="navbar-toggler collapsed ml-auto float-xs-right" type="button" data-toggle="collapse"
					data-target="#navigation" aria-controls="navigation" aria-expanded="false"
					aria-label="Toggle navigation">
					<span class=" fa fa-bars"></span>
				</button>

				<div class="collapse navbar-collapse" id="navigation">
					<ul class="navbar-nav ml-auto">
						<li class="nav-item active">
							<a class="nav-link" href="index.html">Home</a>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true"
								aria-expanded="false">Info</a>
							<ul class="dropdown-menu">
								<li><a class="dropdown-item" href="about.html">About Us </a></li>
								<li><a class="dropdown-item" href="contact.html">Contact us</a></li>
							</ul>
						</li>
						<li class="nav-item active">
							<a class="nav-link" href="weather.html">Weather</a>
						</li>
						<li class="nav-item active">
							<a class="nav-link" href="past-order.html">Past Orders</a>
						</li>
						<li class="nav-item active">
							<a class="nav-link" href="product.html">Product</a>
						</li>
						<li class="nav-item active">
							<a class="nav-link" href="cart.html">Cart</a>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true"
								aria-expanded="false">Reservation</a>
							<ul class="dropdown-menu">
								<li><a class="dropdown-item" href="shipping.html">Shipping</a></li>
								<li><a class="dropdown-item" href="payment.html">Payment</a></li>
								<li><a class="dropdown-item" href="confirmation.html">Confirmation</a></li>
							</ul>
						</li>

						<li class="nav-item">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
						<li>
                            <button id="detail" type="button" class="btn btn-warning" data-toggle="modal" data-target="#myModal">My detail</button>
                        </li>
					</ul>
				</div>
			</div>
		</nav>
	</header>
	<!-- The User detail -->
	<div class="modal" id="myModal">
		<div class="modal-dialog">
			<div class="modal-content">

				<!-- Modal Header -->
				<div class="modal-header">
					<h4 class="modal-title">Hi customer</h4>
					<button type="button" class="close" data-dismiss="modal">&times;</button>
				</div>
				<div id="alert">

				</div>
				<!-- Modal body -->
				<div class="modal-body">
					<h2 id="indicate">Mode</h2>
					<div class="form-group">
						<label class="control-label">Name:</label>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<div class="dropdown">
									<button id="select_button" class="btn btn-secondary dropdown-toggle" type="button">
										Select:
									</button>
									<div id="name_select" class="dropdown-menu">

									</div>
								</div>
							</div>
							<input id="name" type="text" class="form-control">
						</div>
					</div>
					<div id="valid">
						<div class="form-group">
							<label class="control-label">Address:</label>
							<div class="input-group">
								<input id="address" type="text" class="form-control">
								<div class="input-group-append">
									<button id="location" class="btn btn-dark">From map</button>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label class="control-label">Email:</label>
							<input id="email" type="text" class="form-control">
						</div>
						<button id="clearsession" type="button" class="btn btn-warning">Clear my session
						</button>
						<button id="selectsession" type="button" class="btn btn-success">Select session
						</button>
					</div>
				</div>

				<!-- Modal footer -->
				<div class="modal-footer">

					<button id="add" type="button" class="btn btn-primary">Add
					</button>
					<button id="edit" type="button" class="btn btn-secondary">Edit
					</button>
					<button id="remove" type="button" class="btn btn-danger">Remove
					</button>
					<button id="back" type="button" class="btn btn-danger">Back
					</button>
					<button id="save" type="button" class="btn btn-success">Done
					</button>
				</div>
			</div>
		</div>
	</div>
    <!-- Header Close -->
    
    <section class="section-header bg-1">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="text-center">
                        <h1 class="text-capitalize mb-4 font-lg text-white">My Orders</h1>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="section menu-3 secondary-bg" id="fav">
        <div class="container-fluid">
            <div class="row  justify-content-center mb-5">
                <div class="col-lg-8 text-center">
                    <span class="text-primary font-extra font-md text-capitalize">Past Orders</span>
                    <h2 class="mt-3 mb-4">thank you for staying with us!!</h2>
                </div>
            </div>
            <div class="container" id="chart" style="width: 100%;height: 500px;"></div>
        </div>
    </section>

    <section class="pastOrdersTable" style="background-color:azure">
        <div class="row justify-content-center">
            <div id="pastBg" class="col-lg-6">
                <div class="table-responsive">
                    <table class="table text-center table-cart">
                        <thead>
                            <tr>
                                <!-- Initialise Table Headers -->
                                <th scope="col" colspan="2">product name</th>
                                <th scope="col">price</th>
                                <th scope="col">quantity</th>
                                <th scope="col">subtotal</th>
                                <th scope="col"></th>
                            </tr>
                        </thead>
                        <tbody id="producttable">

                            <!--  This is where the products will be listed in rows -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!--Footer start -->
	<footer class="section footer">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-lg-4 col-md-3 mb-5 mb-lg-0">
					<div class="widget">
						<h4 class="mb-3">About</h4>
						<p>JumpMasters hopes to bring you the better best of Malaysia's cusines. Indulge in your
							favourite delights delivered to your doorstep steaming hot! We offer the best prices for
							Malaysia's best night market foods.</p>

						<ul class="list-inline footer-socials mt-4">
							<li class="list-inline-item"><a href="https://www.facebook.com"><i
										class="ti-facebook mr-2"></i></a></li>
							<li class="list-inline-item"><a href="https://wa.link/ybfh21"><i
										class="ti-themify-favicon-alt mr-2"></i></a>
							</li>
						</ul>
					</div>
				</div>

				<div class="col-lg-4 ml-auto col-md-5 mb-5 mb-lg-0">
					<div class="widget">
						<h4 class="mb-3">Contact Info</h4>

						<ul class="list-unstyled mb-0 footer-contact">
							<li><i class="ti-mobile"></i><a class="text-light" href="https://wa.link/ybfh21">+60 11-3810
									0852</a></li>
							<li><i class="ti-email"></i><a class="text-light"
									href="mailto:jumpmasterweb@gmail.com">jumpmasterweb@gmail.com</a></li>
							<li class="text-light"><i class="ti-map"></i>Kampar, Perak Malaysia</li>
						</ul>
					</div>
				</div>
				<div class="col-lg-3 col-md-4 mb-5 mb-lg-0">
					<div class="widget">
						<h4 class="mb-3">Opening Hours</h4>
						<div class="info mb-4">
							<p class="mb-0">Monday - Sunday</p>
							<h5>05:00 PM - 11:00 PM</h5>
						</div>
						<div class="info">
							<p class="mb-0">Physical Stall, Every Wednesday</p>
							<h5>05:00 PM - 11:00 PM</h5>
						</div>
					</div>
				</div>
			</div>

			<div class="row">
				<!-- Google Map Integration -->
				<div class="col-lg-4 col-md-3 mb-5 mb-lg-0">
					<span class="text-primary font-md font-extra">Location</span>
					<div class="gmap_canvas"><iframe width="372" height="206"
							src="https://maps.google.com/maps?q=Grand%20kampar%20Hotel&t=k&z=15&ie=UTF8&iwloc=&output=embed"
							frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe><a
							href="https://www.embedgooglemap.net/blog/nordvpn-coupon-code/"></a></div>
				</div>
				<!-- Google Map Integration End-->

				<div class="col-lg-8 col-md-9 mb-5 mb-lg-0">
					<div class="col-lg-12 text-center">
						<br><br>
						<span class="text-primary font-md font-extra">Get news from Jumpmaster!</span>
						<h4 class="mb-3" style="color:white;">Fill me</h4>
						<div class="form-group">
							<input id="sendemail" type="email" class="form-control" placeholder="Enter Email" required>
							<button id="emailsubmit" class="btn btn-dark">Send</button>
						</div>
					</div>
				</div>
			</div>

		</div>
	</footer>
	<section class="footer-btm py-3">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="d-md-flex justify-content-between align-items-center py-3 text-center text-md-left">
						<p class="mb-0 ">Copyright &copy; 2020 by <a href="index.html" class="text-white">Jumpmaster
								Night Market</a></p>

					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- Footer  End -->

    <!-- jQuery -->
    <script src="plugins/jQuery/jquery.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="plugins/bootstrap/bootstrap.min.js"></script>
    <script src="plugins/aos/aos.js"></script>
    <script src="plugins/shuffle/shuffle.min.js"></script>
    <script src="plugins/magnific-popup/jquery.magnific-popup.min.js"></script>
    <script src="plugins/date-picker/datepicker.min.js"></script>
    <script src="plugins/clock-picker/clockpicker.min.js"></script>
    <script src="plugins/video-popup/jquery-modal-video.min.js"></script>
    <script src="plugins/swiper/swiper.min.js"></script>
    <script src="plugins/bootstrap-touchpin/jquery.bootstrap-touchspin.min.js"></script>

    <!-- Main Script -->
    <script src="js/script.js"></script>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="js/user.js"></script>

    <script>
        var pastOrdersList = null;
        var qty;
        var closebuttons;

        $(window).ready(function () {
            past_init();

            if (past_getItemsNum() !== 0) {
                drawChart();
                console.log(past_getItemsNum());
                updateTable();
                makebuttonswork();
            }
        });

        function getLocalData(name) {
            return localStorage.getItem(name)
        }

        // Function to set data into the LocalStorage
        function setLocalData(name, value) {
            if (value != null)
                localStorage.setItem(name, value);
            else
                localStorage.removeItem(name);
        }

        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.

        function drawChart() {

            google.charts.load('current', { 'packages': ['bar'] });
            google.charts.setOnLoadCallback(function () {
                var columns = [['Products', 'Orders Made']];

                $.each(pastOrdersList, function (index, value) {
                    columns.push([value.PRONAME, parseInt(value.QTORD)]);
                });

                var data = new google.visualization.arrayToDataTable(columns);

                var options = {
                    title: 'Orders Made for Each Product',
                    legend: { position: 'none' },
                    chart: {
                        title: 'Orders Made for Each Product',
                        subtitle: 'popularity by frequency',
                    },
                    bars: 'horizontal', // Required for Material Bar Charts.
                    axes: {
                        x: {
                            0: { side: 'top', label: 'Orders Made' } // Top x-axis.
                        }
                    },
                    bar: { groupWidth: "90%" },
                };

                var chart = new google.charts.Bar(document.getElementById('chart'));
                chart.draw(data, options);
            });
        }

        $(window).resize(function () {
            drawChart();
        });

        //RETRIEVE ARRAY OF JSON OBJECTS
        function past_init() {
            pastOrdersList = new Array();

            if (getLocalData("PastOrdersList") != null) {
                pastOrdersList = JSON.parse(getLocalData("PastOrdersList"));
                console.log(pastOrdersList);
            }
            else {
                console.log("\tList is empty!");
            }
        }

        // Function to update the product rows in the table
        function updateTable() {

            var table = document.getElementById("producttable");
            var subtotal = document.getElementById("subtotal");

            //Clear all existing html in the table body
            table.innerHTML = "";

            var objectNames;
            // Loop throw all items in the cart and initialise a row for each
            for (var i = 0; i < pastOrdersList.length; i++) {
                if (pastOrdersList[i] !== null) {
                    var newRow = table.insertRow(i);
                    var cell1 = newRow.insertCell(0);

                    cell1.innerHTML = '<img src=images/products/' + pastOrdersList[i].IMGSRC + ' alt="" class="img-fluid w-25 mr-3" id="getimage' + i + '">' + '<span class="getnames">' + pastOrdersList[i].PRONAME + '</span>';
                    cell1.classList.add("text-left");
                    var cell2 = newRow.insertCell(1);
                    cell2.innerHTML = '';
                    var cell3 = newRow.insertCell(2);
                    cell3.innerHTML = 'RM' + pastOrdersList[i].PRICE;
                    var cell4 = newRow.insertCell(3);
                    cell4.innerHTML = '<td>' + pastOrdersList[i].QTORD + '</td>';
                    var cell5 = newRow.insertCell(4);
                    cell5.innerHTML = '' + (parseFloat(pastOrdersList[i].PRICE) * parseFloat(pastOrdersList[i].QTORD)).toFixed(2);
                    var cell6 = newRow.insertCell(5);
                    cell6.innerHTML = '<i class="ti-close close" onclick="past_removeRow(' + i + ')"></i>';

                }
            }
            drawChart();
        }

        function makebuttonswork() {
            var table = document.getElementById("producttable");
            var names = document.querySelectorAll(".getnames");
        }

        //getting num items in cart
        function past_getItemsNum() {
            var item = 0;
            for (var xr in pastOrdersList) {
                // i need index of element in this routine so i didn't used OF in iteration
                r = pastOrdersList[xr];
                if (r == null) continue; // Removed ROW - ignore it
                item++;
            }
            return item;
        }

        //remove item from cart
        function past_removeRow(rowid) {
            // Used splice instead of delete because delete leaves a null row in the array. Splice removes the row completely
            pastOrdersList.splice(rowid, 1);
            setLocalData("PastOrdersList", JSON.stringify(pastOrdersList));
            //Update the table whenever an item is deleted
            updateTable();
        }
    </script>
</html>