<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>Jumpmaster Stall Weather</title>

    <link rel="manifest" href="manifest.json">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Jumpmaster Stall">
    <meta name="apple-mobile-web-app-title" content="Jumpmaster Stall">
    <meta name="theme-color" content="#FF9800">
    <meta name="msapplication-navbutton-color" content="#FF9800">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="msapplication-starturl" content="/index.html">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- mobile responsive meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <!-- ** Plugins Needed for the Project ** -->
    <!-- Bootstrap -->
    <link rel="stylesheet" href="plugins/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="plugins/themify/css/themify-icons.css">
	<link rel="stylesheet" href="plugins/icofont/icofont.min.css">
	<link rel="stylesheet" href="plugins/fontawesome/css/all.css">
    <link rel="stylesheet" href="plugins/aos/aos.css">
    <link rel="stylesheet" href="plugins/magnific-popup/magnific-popup.css">
    <link rel="stylesheet" href="plugins/video-popup/modal-video.min.css">
    <link rel="stylesheet" href="plugins/swiper/swiper.min.css">
    <link rel="stylesheet" href="plugins/date-picker/datepicker.min.css">
    <link rel="stylesheet" href="plugins/clock-picker/clockpicker.min.css">
    <link rel="stylesheet" href="plugins/bootstrap-touchpin/jquery.bootstrap-touchspin.min.css">
    <link rel="stylesheet" href="plugins/devices.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css" />
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css" />
    <link rel="stylesheet" href="css/responsive.dataTables.min.css" />

    <script src='https://platform-api.sharethis.com/js/sharethis.js#property=5f49ccb7f73f72001282f8ed&product=sop'
        async='async'></script>
    <link href="css/style.css" rel="stylesheet">
    <link href="css/jquery.dataTables.min.css" rel="stylesheet">
    <script src="https://smtpjs.com/v3/smtp.js">
    </script>
    <!--Favicon-->
    <link rel="shortcut icon" href="images/favicon.png" type="image/x-icon">
    <link rel="icon" href="images/favicon.png" type="image/x-icon">


</head>

<body>
    <!--Loading-->
    <div class="preloader">
        <img src="images/preloader.gif" alt="preloader" class="img-fluid">
    </div>
    <!--Loading End-->

    <!-- Header Start -->
    <!-- Nav Bar-->
    <header class="navigation fixed-top">

        <nav id="navbar" class="navbar navbar-expand-lg main-nav py-lg-3 position-absolute w-100 "
            style="background: url('./images/bg/bg-2.jpg') 10% 10% no-repeat;position: fixed;top: 0;width: 100%;transition: top 0.3s;z-index: -99;">
            <div class="container">
                <a id="logo" class="navbar-brand" style="float:inline-start;z-index: 100;height:auto;"
                    href="index.html">
                    <img src="images/logo.png" alt="" class="img-fluid">
                </a>

                <button class="navbar-toggler collapsed ml-auto float-xs-right" type="button" data-toggle="collapse"
                    data-target="#navigation" aria-controls="navigation" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class=" fa fa-bars"></span>
                </button>

                <div class="collapse navbar-collapse" id="navigation">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="index.html">Home</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true"
								aria-expanded="false">Info</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="about.html">About Us </a></li>
                                <li><a class="dropdown-item" href="contact.html">Contact us</a></li>
                            </ul>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="weather.html">Weather</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="past-order.html">Past Orders</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="product.html">Product</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="cart.html">Cart</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">Reservation</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="shipping.html">Shipping</a></li>
                                <li><a class="dropdown-item" href="payment.html">Payment</a></li>
                                <li><a class="dropdown-item" href="confirmation.html">Confirmation</a></li>
                            </ul>
                        </li>

                        <li class="nav-item">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
                        <li><button id="detail" type="button" class="btn btn-warning" data-toggle="modal"
                                data-target="#myModal">
                                My detail
                            </button></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <!-- The User detail -->
    <div class="modal" id="myModal">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Hi customer</h4>

                    <button type="button" class="close" data-dismiss="modal">&times;</button>

                </div>
                <div id="alert">

                </div>
                <!-- Modal body -->
                <div class="modal-body">
                    <h2 id="indicate">Mode</h2>
                    <div class="form-group">
                        <label class="control-label">Name:</label>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <div class="dropdown">
                                    <button id="select_button" class="btn btn-secondary dropdown-toggle" type="button">
										Select:
									</button>
                                    <div id="name_select" class="dropdown-menu">

                                    </div>
                                </div>
                            </div>
                            <input id="name" type="text" class="form-control">
                        </div>
                    </div>
                    <div id="valid">
                        <div class="form-group">
                            <label class="control-label">Address:</label>
                            <div class="input-group">
                                <input id="address" type="text" class="form-control">
                                <div class="input-group-append">
                                    <button id="location" class="btn btn-dark">From map</button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label">Email:</label>
                            <input id="email" type="text" class="form-control">
                        </div>
                        <button id="clearsession" type="button" class="btn btn-warning">Clear my session
                        </button>
                        <button id="selectsession" type="button" class="btn btn-success">Select session
                        </button>
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">

                    <button id="add" type="button" class="btn btn-primary">Add
                    </button>
                    <button id="edit" type="button" class="btn btn-secondary">Edit
                    </button>
                    <button id="remove" type="button" class="btn btn-danger">Remove
                    </button>
                    <button id="back" type="button" class="btn btn-danger">Back
                    </button>
                    <button id="save" type="button" class="btn btn-success">Done
                    </button>
                </div>

            </div>
        </div>
    </div>
    <!-- Header Close -->

    <!-- Banner -->
    <section class="section-header bg-1">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="text-center">
                        <h1 class="text-capitalize mb-4 font-lg text-white">Weather</h1>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Banner End -->

    <!--Calling Restfull API and displaying result with paging and filtering-->
    <section style="background-color:lightgoldenrodyellow">
        <div class="row  justify-content-center">
            <div class="col-lg-8 text-center">
                <span class="text-primary font-extra font-md">Your Weather</span>
                <h2 class="mt-3 mb-4">For your reference</h2>
            </div>
        </div>

        <div class="container-fluid" style="padding: 100px;">
            <table id="weathertable" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th class="th-sm">No</th>
                        <th class="th-sm">Time</th>
                        <th class="th-sm">Temperature</th>
                        <th class="th-sm">Description</th>
                        <th class="th-sm">Our word</th>
                    </tr>
                </thead>
                <tbody id="producttable">
                </tbody>
            </table>
        </div>
    </section>

    <section style="background-color:lightblue">
        <div class="row  justify-content-center">
            <div class="col-lg-8 text-center">
                <span class="text-primary font-extra font-md">The current stall Temperature(°C)</span>
                <h2 class="mt-3 mb-4">The temperature chart in 48 hours (°C) </h2>
            </div>
        </div>

        <div class="mapouter container-fluid p-0 d-flex justify-content-center">
            <div id="chart_div" class="justify-content-center" style="width:100%; height:500px; "></div>
        </div>
        <br><br>
    </section>
    <!--API pagging and displaying end-->

    <!--Footer start -->
    <footer class="section footer">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-4 col-md-3 mb-5 mb-lg-0">
                    <div class="widget">
                        <h4 class="mb-3">About</h4>
                        <p>JumpMasters hopes to bring you the better best of Malaysia's cusines. Indulge in your
                            favourite delights delivered to your doorstep steaming hot! We offer the best prices for
                            Malaysia's best night market foods.</p>
                        <ul class="list-inline footer-socials mt-4">
                            <li class="list-inline-item"><a href="https://www.facebook.com"><i
                                        class="ti-facebook mr-2"></i></a></li>
                            <li class="list-inline-item"><a href="https://wa.link/ybfh21"><i
                                        class="ti-themify-favicon-alt mr-2"></i></a>
                            </li>
                        </ul>
                    </div>
                </div>


                <div class="col-lg-4 ml-auto col-md-5 mb-5 mb-lg-0">
                    <div class="widget">
                        <h4 class="mb-3">Contact Info</h4>
                        <ul class="list-unstyled mb-0 footer-contact">
                            <li><i class="ti-mobile"></i><a class="text-light" href="https://wa.link/ybfh21">+60 11-3810
                                    0852</a></li>
                            <li><i class="ti-email"></i><a class="text-light"
                                    href="mailto:jumpmasterweb@gmail.com">jumpmasterweb@gmail.com</a></li>
                            <li class="text-light"><i class="ti-map"></i>Kampar, Perak Malaysia</li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3 col-md-4 mb-5 mb-lg-0">
                    <div class="widget">
                        <h4 class="mb-3">Opening Hours</h4>

                        <div class="info mb-4">
                            <p class="mb-0">Monday - Sunday</p>
                            <h5>05:00 PM - 11:00 PM</h5>
                        </div>
                        <div class="info">
                            <p class="mb-0">Physical Stall, Every Wednesday</p>
                            <h5>05:00 PM - 11:00 PM</h5>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Google Map Integration -->
                <div class="col-lg-4 col-md-3 mb-5 mb-lg-0">
                    <span class="text-primary font-md font-extra">Location</span>
                    <div class="gmap_canvas"><iframe width="372" height="206" id="gmap_canvas"
                            src="https://maps.google.com/maps?q=Grand%20kampar%20Hotel&t=k&z=15&ie=UTF8&iwloc=&output=embed"
                            frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe><a
                            href="https://www.embedgooglemap.net/blog/nordvpn-coupon-code/"></a></div>
                </div>
                <!-- Google Map Integration End-->

                <div class="col-lg-8 col-md-9 mb-5 mb-lg-0">
                    <div class="col-lg-12 text-center">
                        <br><br>
                        <span class="text-primary font-md font-extra">Get news from Jumpmaster!</span>
                        <h4 class="mb-3" style="color:white;">Fill me</h4>
                        <div class="form-group">
                            <input id="sendemail" type="email" class="form-control" placeholder="Enter Email" required>
                            <button id="emailsubmit" class="btn btn-dark">Send</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </footer>
    <section class="footer-btm py-3">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="d-md-flex justify-content-between align-items-center py-3 text-center text-md-left">
                        <p class="mb-0 ">Copyright &copy; 2020 by <a href="index.html" class="text-white">Jumpmaster
                                Night Market</a></p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Footer  End -->


    <!-- jQuery -->
    <script src="plugins/jQuery/jquery.min.js"></script>
    <script src="js/pagination.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="plugins/bootstrap/bootstrap.min.js"></script>
    <script src="plugins/aos/aos.js"></script>
    <script src="plugins/shuffle/shuffle.min.js"></script>
    <script src="plugins/magnific-popup/jquery.magnific-popup.min.js"></script>
    <script src="plugins/date-picker/datepicker.min.js"></script>
    <script src="plugins/clock-picker/clockpicker.min.js"></script>
    <script src="plugins/video-popup/jquery-modal-video.min.js"></script>
    <script src="plugins/swiper/swiper.min.js"></script>
    <script src="plugins/bootstrap-touchpin/jquery.bootstrap-touchspin.min.js"></script>

    <!-- Main Script -->
    <script src="js/script.js"></script>
    <script src="js/user.js"></script>

    <!--Chart-->
    <script src="js/jquery.dataTables.min.js"></script>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="js/dataTables.responsive.min.js"></script>


    <!-- Weather API filtering and pagging after get JSON -->
    <!-- We call the restfull API using getJson method and displaying the result-->
    <!-- We made the display after filtering in backend-->
    <!-- And also can let user to filter the data on their own.-->
    <!-- Pagging is also be done, for a optimise view, user can view the data in our user friendly interface-->
    <script>
        var weather;
        var hourly;
        // The latitude and longitude to get weather
        const latitude = 4.327522;
        const longitude = 101.1431352;
        // API KEY
        const key = "4e1eedc8b38635c415678d2872793e3a";

        $(document).ready(function () {
            //fetch
            function fetchStatusHandler(response) {
                if (response.status === 200) {
                    return response;
                } else {
                    throw new Error(response.statusText);
                }
            }

            //get the data from the API key
            fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${latitude}&lon=${latitude}&exclude=daily&appid=${key}`)
                .then(
                    fetchStatusHandler
                ).then(function () {
                    //get the JSON array
                    function getArray() {
                        return $.getJSON(`https://api.openweathermap.org/data/2.5/onecall?lat=${latitude}&lon=${latitude}&exclude=daily&appid=${key}`);
                    }
                    getArray().done(function (json) {
                        // now we can use json
                        weather = json;
                        updateTable();
                        //need to made mobile responsive
                        $('#weathertable').DataTable({
                            "pagingType": "full_numbers",
                            responsive: true
                        });
                        $('.dataTables_length').addClass('bs-select');
                    });
                }).catch(function () {
                    // if error occur, alert to user
                    alert("An error occur, try refresh or restart the brownser");
                });
        });

        //Filter and paging
        // Create the data table.
        // Data table already consits:
        // Filter: search button, and the show how many record in a same time button
        // Pagination: pages button(1st, 2nd, previous, next, end page button)
        // Search: search(filter also)
        // Sort button, in every header, just clicking, and it will sort by alphabatecal, or small to largest
        // depending on datatype
        function updateTable() {
            hourly = weather.hourly;
            console.log(hourly);
            var table = document.getElementById("producttable");
            table.innerHTML = "";

            // adding row and the cell of each row
            for (var i = 0; i < hourly.length; i++) {

                var newRow = table.insertRow(i);
                var cell1 = newRow.insertCell(0);
                cell1.innerHTML = i + 1;
                cell1.classList.add("text-left");

                var cell2 = newRow.insertCell(1);
                cell2.innerHTML = timeConverter(hourly[i].dt);
                cell2.classList.add("text-left");

                var cell3 = newRow.insertCell(2);
                cell3.innerHTML = (hourly[i].temp - 273.15).toFixed(2); // change Kelvin to degree celcius

                var cell4 = newRow.insertCell(3);
                cell4.innerHTML = hourly[i].weather[0].description; // The weather description, rainning, cloudy and etc

                var cell5 = newRow.insertCell(4);
                // base on the weather give some 
                // we try to use malaysian style language
                if (hourly[i].weather[0].icon != "09d" && hourly[i].weather[0].icon != "09n" && hourly[i].weather[0].icon != "10d" && hourly[i].weather[0].icon != "10n" &&
                    hourly[i].weather[0].icon != "11d" && hourly[i].weather[0].icon != "11n")
                    cell5.innerHTML = "Good day lah, come pasar malam lar";
                else
                    cell5.innerHTML = " Weather no good lah. You can order delivery mah, dont come out in rainy day";

            }
        }
        //for conversion of a unix timestamp, to string type
        function timeConverter(UNIX_timestamp) {
            var a = new Date(UNIX_timestamp * 1000);
            var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            var year = a.getFullYear();
            var month = months[a.getMonth()];
            var date = a.getDate();
            var hour = a.getHours();
            var min = a.getMinutes();
            var sec = a.getSeconds();
            var time = date + ' ' + month + ' ' + year + ' ' + hour + ':' + min + ':' + sec;
            return time;
        }
    </script>


    <!-- The Google Chart -->
    <!-- We use dynamic data from Restful API and process the data gotten and display in google chart-->
    <script>
          
        // to type of conversion, for different usage
        function timeConverter2(UNIX_timestamp) {
            var a = new Date(UNIX_timestamp * 1000);
            var hour = a.getHours();
            if (hour == 0)
                return "12am";
            else if (hour < 12)
                return hour + "am";
            else if (hour >= 13)
                return (hour - 12) + "pm";
            else
                return "12pm";

        }

        $(document).ready(function () {
            // Load the Visualization API and the corechart package.
            google.charts.load('current', { 'packages': ['corechart'] });

            // Set a callback to run when the Google Visualization API is loaded.
            google.charts.setOnLoadCallback(drawChart);

            // Callback that creates and populates a data table,
            function drawChart() {

                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Date');
                data.addColumn('number', 'Temperature(°C)');


                // looping for 48 hour broadcast (here filter out only nessecery information in code(backend))
                var content = [];
                for (var i = 0; i < weather.hourly.length; i++) {
                    if (i == 0)
                        content.push([timeConverter2(weather.hourly[i].dt) + " (Now)", parseFloat((weather.hourly[i].temp - 273.15).toFixed(2))]);
                    else if (i == 23 || i == 24)
                        content.push([timeConverter2(weather.hourly[i].dt) + " (Next Day)", parseFloat((weather.hourly[i].temp - 273.15).toFixed(2))]);
                    else
                        content.push([timeConverter2(weather.hourly[i].dt), parseFloat((weather.hourly[i].temp - 273.15).toFixed(2))]);
                }
                data.addRows(content);

                // Set the google chart options
                var options = {
                    animation: {
                        startup: true,
                        duration: 1000,
                        easing: 'in'
                    },
                    // Set the background and the legend
                    backgroundColor: { fill: 'transparent' },
                    legend: { position: 'bottom', alignment: 'start' },
                    hAxis: {
                        textStyle: {
                            fontSize: 12
                        }
                    },
                    //responsice is important
                    responsive: true,
                    curveType: 'function',
                }

                // Instantiate and draw our chart, passing in some options.
                var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
                chart.draw(data, options);
            }

            //draw again chart when resize, made it responsive
            $(window).resize(function () {
                drawChart();
            });
        });
    </script>

</body>

</html>